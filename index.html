<!DOCTYPE html>
<html>
<head>
    <title>tic.tac.toe</title>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <meta name="author" content="Marco Eccel">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

    <!-- first row-->
    <div>
        <button id="0,0" onclick="claimCell('0,0')" class="button" type="button">  </button>
        <button id="0,1" onclick="claimCell('0,1')" class="button" type="button">  </button>
        <button id="0,2" onclick="claimCell('0,2')" class="button" type="button">  </button>
    </div>
    <!-- second row-->
    <div>
        <button id="1,0" onclick="claimCell('1,0')" class="button" type="button">  </button>
        <button id="1,1" onclick="claimCell('1,1')" class="button" type="button">  </button>
        <button id="1,2" onclick="claimCell('1,2')" class="button" type="button">  </button>
    </div>
    <!-- third row-->
    <div>
        <button id="2,0" onclick="claimCell('2,0')" class="button" type="button">  </button>
        <button id="2,1" onclick="claimCell('2,1')" class="button" type="button">  </button>
        <button id="2,2" onclick="claimCell('2,2')" class="button" type="button">  </button>
    </div>

    <p id="player"> </p>
    <br>
    <button id="restartButton" onclick="restart()" class="button1" type="button">restart</button>
    <script language="javascript">
        let playField = [];
        for(let i = 0; i < 3; i++){
            playField[i] = new Array(3);
        }
        let currentPlayer = 2; //player X is 1, player O is 2

        cleanField();


        function claimCell(id){
            let button = document.getElementById(id);
            let [x,y] =id.split(",");

            changePlayer();
            button.classList.add(getPlayerName());
            button.innerText=getPlayerName();
            button.disabled=true;
            
            playField[x][y] = currentPlayer;
            

            if(checkWin(currentPlayer)){
                disableField(true);
                document.getElementById("player").innerText = getPlayerName() + " won the game";
            }
        }

        function getPlayerName(){
            if(currentPlayer ==1){
                return "X";
            }else if(currentPlayer ==2){
                return "O";
            }
            return "error"
        }

        function changePlayer(){
            document.getElementById("player").innerText=getPlayerName() + " turn";
            if(currentPlayer==1){
                currentPlayer =2;
            }else{
                currentPlayer =1;
            }
        }

        function disableField(state){ //disable all the buttons
            let buttons = document.getElementsByClassName("button");
            
            for(let i = 0; i < buttons.length; i++){
                buttons[i].disabled=state;
            }
        }
        
        function checkWin(whichPlayer){
            if(diagonal(whichPlayer) || orizzontalOrVertical(whichPlayer)){
                return true;
            }
            return false;
        }
    

        
        function orizzontalOrVertical(whichPlayer){
            let ret = false;
            for(let i = 0; i < 3; i++){
                if(playField[i][0] == playField[i][1] &&  playField[i][1] == playField[i][2] && playField[i][2] == whichPlayer){
                    console.log(whichPlayer + "orizzontal true");
                    ret = true;
                }
                if(playField[0][i] == playField[1][i] && playField[1][i] == playField[2][i] && playField[2][i] == whichPlayer){
                    console.log(whichPlayer + "vertical true");
                    ret = true;
                }
            }
            return ret;
        }
        function diagonal(whichPlayer){
            let tmp = false;
            if(playField[0][0] == playField[1][1] && playField[1][1] == playField[2][2] && playField[2][2] == whichPlayer){
                tmp = true;
                }
            if(playField[2][0] == playField[1][1] && playField[1][1] == playField[0][2] && playField[0][2] == whichPlayer){
                tmp = true;
            }
            console.log(whichPlayer + "diagonal"+ tmp);
            return tmp;
        }

        function cleanField(){
            for(let i = 0; i < 3; i++){
                for(let j = 0; j < 3; j++){
                    playField[i][j] = 0;
                }
            }
        }

        function cleanButtons(){
            let buttons = document.getElementsByClassName("O");
            
            for(let i = 0; i <= buttons.length; i++){
                buttons[i].classList.remove("O");
                buttons[i].innerText="";
            }

            buttons = document.getElementsByClassName("X");

            for(let i = 0; i <= buttons.length; i++){
                buttons[i].classList.remove("X");
                buttons[i].innerText="";
            }
        }

        function restart(){
            cleanButtons();
            cleanField();
            changePlayer();
            disableField(false);
        }
    </script>

</body>
</html>